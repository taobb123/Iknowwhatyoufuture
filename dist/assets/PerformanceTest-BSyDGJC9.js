import{r as g,j as e}from"./index-DjexH7CO.js";const y=()=>{const d=t=>({id:`user_${t}`,username:`testuser${t}`,email:`test${t}@example.com`,password:"hashedpassword",role:"user",userType:"regular",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),o=t=>({id:`article_${t}`,title:`测试文章标题 ${t}`,content:"这是一篇测试文章的内容。".repeat(100),category:"测试分类",authorId:`user_${t%10}`,authorType:"regular",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),n=(t,l)=>{console.log(`
=== 测试 ${l} (${t} 条记录) ===`);const a=performance.now(),s=[];for(let x=0;x<t;x++)l==="users"?s.push(d(x)):l==="articles"&&s.push(o(x));const c=performance.now();console.log(`数据生成耗时: ${(c-a).toFixed(2)}ms`);const u=performance.now();localStorage.setItem(`test_${l}`,JSON.stringify(s));const h=performance.now();console.log(`写入 localStorage 耗时: ${(h-u).toFixed(2)}ms`);const f=performance.now(),j=localStorage.getItem(`test_${l}`);JSON.parse(j||"[]");const p=performance.now();console.log(`读取并解析耗时: ${(p-f).toFixed(2)}ms`);const b=new Blob([JSON.stringify(s)]).size;return console.log(`数据大小: ${(b/1024).toFixed(2)}KB`),localStorage.removeItem(`test_${l}`),{generateTime:c-a,writeTime:h-u,readTime:p-f,dataSize:b}},i=[10,50,100,500,1e3],r={};console.log(`🚀 开始 localStorage 性能测试...
`),i.forEach(t=>{r[t]={users:n(t,"users"),articles:n(t,"articles")}}),console.log(`
📊 性能测试结果汇总:`),console.log("数据量	用户写入	用户读取	文章写入	文章读取	文章大小"),console.log("-----	--------	--------	--------	--------	--------"),i.forEach(t=>{const l=r[t].users,a=r[t].articles;console.log(`${t}	${l.writeTime.toFixed(2)}ms	${l.readTime.toFixed(2)}ms	${a.writeTime.toFixed(2)}ms	${a.readTime.toFixed(2)}ms	${(a.dataSize/1024).toFixed(2)}KB`)}),console.log(`
💡 性能建议:`);const m=r[1e3].articles.dataSize/1024;return m>1e3?console.log("⚠️  文章数据超过 1MB，建议优化存储策略"):m>500?console.log("🟡 文章数据较大，建议考虑分页加载"):console.log("✅ 数据量在合理范围内，性能良好"),r},N=()=>{const d=["gamehub_users","simple_users","gamehub_articles","gamehub_boards","gamehub_topics","system_config"];let o=0;return console.log(`
📏 当前 localStorage 数据大小:`),console.log("键名			大小"),console.log("----			----"),d.forEach(n=>{const i=localStorage.getItem(n);if(i){const r=new Blob([i]).size;o+=r,console.log(`${n}		${(r/1024).toFixed(2)}KB`)}}),console.log(`
总大小: ${(o/1024).toFixed(2)}KB`),o>5e3?console.log("⚠️  数据量较大，建议迁移到数据库"):o>1e3?console.log("🟡 数据量中等，建议监控性能"):console.log("✅ 数据量合理，性能良好"),o},w=()=>{const[d,o]=g.useState(0),[n,i]=g.useState(null),[r,m]=g.useState(!1);g.useEffect(()=>{const s=N();o(s)},[]);const t=async()=>{m(!0);try{const s=y();i(s)}catch(s){console.error("性能测试失败:",s)}finally{m(!1)}},a=(s=>s>5e3?{status:"warning",message:"⚠️ 数据量较大，建议迁移到数据库",color:"text-red-600"}:s>1e3?{status:"caution",message:"🟡 数据量中等，建议监控性能",color:"text-yellow-600"}:{status:"good",message:"✅ 数据量合理，性能良好",color:"text-green-600"})(d);return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"🚀 localStorage 性能测试"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"当前数据状态"}),e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-lg font-medium",children:"总数据大小:"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[(d/1024).toFixed(2)," KB"]})]}),e.jsx("div",{className:`text-lg font-medium ${a.color}`,children:a.message})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"性能压力测试"}),e.jsx("button",{onClick:t,disabled:r,className:`px-6 py-3 rounded-lg font-medium transition-colors ${r?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:r?"测试中...":"开始性能测试"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"测试不同数据量下的读写性能"})]}),n&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"测试结果"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"数据量"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"用户写入"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"用户读取"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"文章写入"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"文章读取"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"文章大小"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:Object.entries(n).map(([s,c])=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:s}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[c.users.writeTime.toFixed(2),"ms"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[c.users.readTime.toFixed(2),"ms"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[c.articles.writeTime.toFixed(2),"ms"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[c.articles.readTime.toFixed(2),"ms"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[(c.articles.dataSize/1024).toFixed(2),"KB"]})]},s))})]})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"💡 性能优化建议"}),e.jsxs("ul",{className:"text-blue-700 space-y-1",children:[e.jsx("li",{children:"• 如果数据量超过 1MB，建议迁移到数据库"}),e.jsx("li",{children:"• 考虑实现数据分页加载，避免一次性加载所有数据"}),e.jsx("li",{children:"• 定期清理无用的缓存数据"}),e.jsx("li",{children:"• 使用 IndexedDB 替代 localStorage（支持更大存储）"}),e.jsx("li",{children:"• 实现数据压缩和去重机制"})]})]})]})})})};export{w as default};

import{h as Z,b as ee,u as se,a as oe,i as te,r,k as re,j as e,J as D,U as le,E as ce}from"./index-Du8BMbyU.js";import{g as I,a as $}from"./databaseBoardManager-DAhEahQI.js";import{g as B,a as v}from"./databaseTopicManager-vpp9uVJX.js";import{i as ae,g as z}from"./databaseArticleManager-BChPH7IT.js";import{T as ie}from"./thumbs-up-B27OMDBK.js";import{M as ne}from"./message-square-CYRk6Jus.js";const be=()=>{var R,M,E,P;const p=Z(),G=ee(),{currentTheme:o}=se(),{t:i}=oe(),{state:d,getUserDisplayName:Q}=te(),[N,C]=r.useState([]),[k,w]=r.useState([]),[U,g]=r.useState(!0),[n,S]=r.useState(""),[b,H]=r.useState("å…¨éƒ¨"),[f,_]=r.useState("æœ€æ–°"),[m,A]=r.useState([]),[j,T]=r.useState([]),[de,q]=r.useState([]),[me,F]=r.useState([]),[c,h]=r.useState(1),[y]=r.useState(5),[x,J]=r.useState(1),[L,K]=r.useState([]);r.useEffect(()=>{O()},[]),r.useEffect(()=>{if(p.state){const s=p.state;s.searchQuery&&S(s.searchQuery),s.selectedCategory&&H(s.selectedCategory)}},[p.state]);const O=async()=>{try{console.log("å¼€å§‹åŠ è½½ç¤¾åŒºæ•°æ®..."),await ae(),setTimeout(async()=>{const a=(await z()).filter(u=>u.status==="published");A(a),T(a)},100);const s=await I(),t=await B();if(console.log("åŠ è½½çš„æ•°æ®:",{boards:s.length,topics:t.length,articles:m.length}),s.length===0||t.length===0){console.log("æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ›å»ºæµ‹è¯•æ•°æ®..."),Y();return}C(s),w(t),g(!1)}catch(s){console.error("åŠ è½½æ•°æ®å¤±è´¥:",s),g(!1)}};r.useEffect(()=>{const s=re.map(a=>({...a,category:a.category||"æœªåˆ†ç±»",thumbnail:a.image||"/car-racing.webp"})),t=[...s].sort((a,u)=>u.likes-a.likes).slice(0,10);q(t);const l=[...s].sort(()=>Math.random()-.5).slice(0,10);F(l)},[]),r.useEffect(()=>{let s=m;switch(b!=="å…¨éƒ¨"&&(s=s.filter(t=>t.category===b)),n.trim()&&(s=s.filter(t=>t.title.toLowerCase().includes(n.toLowerCase())||t.content.toLowerCase().includes(n.toLowerCase())||t.tags.some(l=>l.toLowerCase().includes(n.toLowerCase())))),f){case"æœ€æ–°":s.sort((t,l)=>new Date(l.createdAt).getTime()-new Date(t.createdAt).getTime());break;case"çƒ­é—¨":s.sort((t,l)=>l.likes-t.likes);break;case"æœ€å¤šæµè§ˆ":s.sort((t,l)=>l.views-t.views);break;case"æœ€å¤šè¯„è®º":s.sort((t,l)=>l.comments-t.comments);break}T(s),h(1)},[m,b,n,f]),r.useEffect(()=>{const s=Math.ceil(j.length/y);J(s);const t=(c-1)*y,l=t+y,a=j.slice(t,l);K(a)},[j,c,y]);const V=s=>{h(s)},W=()=>{c>1&&h(c-1)},X=()=>{c<x&&h(c+1)};Q(),((R=d.user)==null?void 0:R.role)==="admin"||((M=d.user)==null?void 0:M.role)==="superAdmin"?`${((E=d.user)==null?void 0:E.level)||10}`:`${((P=d.user)==null?void 0:P.level)||1}`,m.filter(s=>{var t;return s.authorId===((t=d.user)==null?void 0:t.id)}).length,m.filter(s=>{var t;return s.authorId===((t=d.user)==null?void 0:t.id)}).reduce((s,t)=>s+(t.likes||0),0);const Y=async()=>{try{console.log("åˆ›å»ºæµ‹è¯•æ•°æ®...");const s=await $({name:"æ¸¸æˆæ”»ç•¥",description:"åˆ†äº«å„ç§æ¸¸æˆçš„æ”»ç•¥å’ŒæŠ€å·§",icon:"ðŸŽ®",color:"from-blue-600 to-purple-600",order:0,isActive:!0}),t=await $({name:"æŠ€æœ¯è®¨è®º",description:"å‰ç«¯å¼€å‘å’ŒæŠ€æœ¯äº¤æµ",icon:"ðŸ’»",color:"from-green-600 to-teal-600",order:0,isActive:!0});await v({name:"æ–°æ‰‹å…¥é—¨",description:"é€‚åˆæ–°æ‰‹çš„æ¸¸æˆæ”»ç•¥",boardId:s.id,icon:"ðŸŒŸ",color:"from-yellow-500 to-orange-500",order:0,isActive:!0}),await v({name:"é«˜çº§æŠ€å·§",description:"é«˜çº§çŽ©å®¶åˆ†äº«çš„æŠ€å·§",boardId:s.id,icon:"âš¡",color:"from-purple-500 to-pink-500",order:1,isActive:!0}),await v({name:"å‰ç«¯å¼€å‘",description:"å‰ç«¯æŠ€æœ¯è®¨è®º",boardId:t.id,icon:"ðŸŽ¨",color:"from-indigo-500 to-blue-500",order:0,isActive:!0}),console.log("æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆ");const l=await I(),a=await B(),u=await z();C(l),w(a),A(u.slice(0,5)),g(!1)}catch(s){console.error("åˆ›å»ºæµ‹è¯•æ•°æ®å¤±è´¥:",s),g(!1)}};return U?e.jsx("div",{className:"min-h-screen text-white flex items-center justify-center",style:{backgroundColor:o.colors.background},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:o.colors.textSecondary}}),e.jsx("p",{style:{color:o.colors.text},children:"åŠ è½½ä¸­..."})]})}):e.jsx("div",{className:"min-h-screen text-white pt-20",style:{backgroundColor:o.colors.background},children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"rounded-2xl p-8 mb-8",style:{background:`linear-gradient(135deg, ${o.colors.primary}, ${o.colors.secondary})`,borderRadius:o.borderRadius.xl},children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",style:{color:o.colors.text},children:i("community.title")}),e.jsx("p",{className:"text-xl mb-6",style:{color:o.colors.textSecondary},children:i("community.subtitle")}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.text},children:N.length}),e.jsx("div",{style:{color:o.colors.textSecondary},children:i("community.boards")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.text},children:k.length}),e.jsx("div",{style:{color:o.colors.textSecondary},children:i("community.topics")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:o.colors.text},children:m.length}),e.jsx("div",{style:{color:o.colors.textSecondary},children:i("community.articles")})]})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:o.colors.text},children:i("community.hotBoards")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(s=>e.jsxs("div",{className:"rounded-xl p-6 transition-colors",style:{backgroundColor:o.colors.surface,borderRadius:o.borderRadius.xl},onMouseEnter:t=>{t.currentTarget.style.backgroundColor=o.colors.hover},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=o.colors.surface},children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"text-3xl mr-3",children:s.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",style:{color:o.colors.text},children:s.name}),e.jsxs("p",{className:"text-sm",style:{color:o.colors.textSecondary},children:[s.topicCount," ä¸ªä¸»é¢˜"]})]})]}),e.jsx("p",{className:"mb-4",style:{color:o.colors.textSecondary},children:s.description}),e.jsx(D,{to:`/board/${s.id}`,className:"inline-flex items-center transition-colors",style:{color:o.colors.primary},onMouseEnter:t=>{t.currentTarget.style.color=o.colors.hover},onMouseLeave:t=>{t.currentTarget.style.color=o.colors.primary},children:"è¿›å…¥æ¿å— â†’"})]},s.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:o.colors.text},children:i("community.hotTopics")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map(s=>e.jsxs("div",{className:"rounded-lg p-4 transition-colors",style:{backgroundColor:o.colors.surface,borderRadius:o.borderRadius.lg},onMouseEnter:t=>{t.currentTarget.style.backgroundColor=o.colors.hover},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=o.colors.surface},children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-2xl mr-2",children:s.icon}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:o.colors.text},children:s.name})]}),e.jsx("p",{className:"text-sm mb-2",style:{color:o.colors.textSecondary},children:s.description}),e.jsx(D,{to:`/topic/${s.id}`,className:"text-sm transition-colors",style:{color:o.colors.primary},onMouseEnter:t=>{t.currentTarget.style.color=o.colors.hover},onMouseLeave:t=>{t.currentTarget.style.color=o.colors.primary},children:"æŸ¥çœ‹ä¸»é¢˜ â†’"})]},s.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:o.colors.text},children:"æœ€æ–°æ–‡ç« "}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"æœç´¢æ–‡ç« ...",value:n,onChange:s=>S(s.target.value),className:"w-full px-4 py-2 rounded-lg border-0",style:{backgroundColor:o.colors.surface,color:o.colors.text,borderRadius:o.borderRadius.lg}})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:f,onChange:s=>_(s.target.value),className:"px-4 py-2 rounded-lg border-0",style:{backgroundColor:o.colors.surface,color:o.colors.text,borderRadius:o.borderRadius.lg},children:[e.jsx("option",{value:"æœ€æ–°",children:"æœ€æ–°"}),e.jsx("option",{value:"çƒ­é—¨",children:"çƒ­é—¨"}),e.jsx("option",{value:"æœ€å¤šæµè§ˆ",children:"æœ€å¤šæµè§ˆ"}),e.jsx("option",{value:"æœ€å¤šè¯„è®º",children:"æœ€å¤šè¯„è®º"})]})})]}),L.length>0?e.jsx("div",{className:"space-y-4",children:L.map(s=>!s||!s.id||!s.title?null:e.jsx("div",{className:"rounded-lg p-4 transition-colors",style:{backgroundColor:o.colors.surface,borderRadius:o.borderRadius.lg},onMouseEnter:t=>{t.currentTarget.style.backgroundColor=o.colors.hover},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=o.colors.surface},children:e.jsx("div",{className:"flex items-start gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold cursor-pointer transition-colors",style:{color:o.colors.text},onClick:()=>G(`/article/article_${s.id}`),onMouseEnter:t=>{t.currentTarget.style.color=o.colors.primary},onMouseLeave:t=>{t.currentTarget.style.color=o.colors.text},children:s.title}),e.jsx("span",{className:"px-2 py-1 text-xs rounded",style:{backgroundColor:o.colors.primary,color:o.colors.text,borderRadius:o.borderRadius.sm},children:s.category})]}),e.jsxs("p",{className:"text-sm mb-3 line-clamp-2",style:{color:o.colors.textSecondary},children:[s.content.substring(0,150),"..."]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-2",style:{color:o.colors.textSecondary},children:[e.jsx(le,{size:12}),e.jsx("span",{children:s.author||"æœªçŸ¥ä½œè€…"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:s.createdAt?new Date(s.createdAt).toLocaleDateString("zh-CN"):"æœªçŸ¥æ—¥æœŸ"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",style:{color:o.colors.textSecondary},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{size:10}),e.jsx("span",{children:s.views||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{size:10}),e.jsx("span",{children:s.likes||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{size:10}),e.jsx("span",{children:s.comments||0})]})]})]})})},s.id))}):e.jsx("div",{className:"rounded-lg p-6 text-center",style:{backgroundColor:o.colors.surface},children:e.jsx("p",{className:"text-sm",style:{color:o.colors.textSecondary},children:n?"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« ":"æš‚æ— æ–‡ç« "})}),x>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-6",children:[e.jsx("button",{onClick:W,disabled:c===1,className:"px-3 py-2 rounded-lg transition-colors disabled:opacity-50",style:{backgroundColor:c===1?o.colors.surface:o.colors.primary,color:o.colors.text,borderRadius:o.borderRadius.lg},children:"ä¸Šä¸€é¡µ"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:x},(s,t)=>t+1).map(s=>e.jsx("button",{onClick:()=>V(s),className:`px-3 py-2 rounded-lg transition-colors ${s===c?"font-bold":""}`,style:{backgroundColor:s===c?o.colors.primary:o.colors.surface,color:o.colors.text,borderRadius:o.borderRadius.lg},children:s},s))}),e.jsx("button",{onClick:X,disabled:c===x,className:"px-3 py-2 rounded-lg transition-colors disabled:opacity-50",style:{backgroundColor:c===x?o.colors.surface:o.colors.primary,color:o.colors.text,borderRadius:o.borderRadius.lg},children:"ä¸‹ä¸€é¡µ"})]})]})]})})};export{be as default};

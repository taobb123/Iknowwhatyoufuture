import{h as G,r as o,j as e,W as u,A as g}from"./index-BCw3XfMH.js";import{m as S}from"./minimalRegistration-BGXYDreK.js";const E=()=>{var h,b,f;const{state:a,registerGuest:k}=G(),[r,p]=o.useState(""),[n,j]=o.useState(""),[x,y]=o.useState(""),[m,t]=o.useState(""),[l,i]=o.useState(!1),w=()=>r.trim()?r.length<3?(t("❌ 用户名至少3个字符"),!1):n?n.length<6?(t("❌ 密码至少6个字符"),!1):n!==x?(t("❌ 两次输入的密码不一致"),!1):!0:(t("❌ 请输入密码"),!1):(t("❌ 请输入用户名"),!1),N=async()=>{if(w()){i(!0),t("注册中...");try{const s=u(),c=g();if(console.log("注册前状态:",{currentUser:s,allUsers:c,username:r,isGuest:s==null?void 0:s.isGuest}),!s||!s.isGuest){t("❌ 当前用户不是游客，无法注册"),i(!1);return}if(c.find(d=>d.username===r)){t(`❌ 用户名 "${r}" 已存在`),i(!1);return}if(S(r,n)){t("✅ 注册成功！");const d=u(),C=g();console.log("注册后状态:",{newCurrentUser:d,newAllUsers:C})}else t("❌ 注册失败")}catch(s){console.error("注册错误:",s),t(`❌ 注册错误: ${s instanceof Error?s.message:s}`)}finally{i(!1)}}},v=()=>{const s=u(),c=g();console.log("当前状态:",{currentUser:s,allUsers:c,authState:a}),t(`当前用户: ${(s==null?void 0:s.username)||"无"}, 类型: ${(s==null?void 0:s.userType)||"无"}, 是否游客: ${s!=null&&s.isGuest?"是":"否"}`)};return e.jsx("div",{className:"min-h-screen bg-gray-900 text-white pt-20",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center",children:"最小MVP注册"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"状态检查"}),e.jsx("button",{onClick:v,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mb-4",children:"检查当前状态"}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"当前用户:"})," ",((h=a.user)==null?void 0:h.username)||"无"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"用户类型:"})," ",((b=a.user)==null?void 0:b.userType)||"无"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"是否游客:"})," ",(f=a.user)!=null&&f.isGuest?"是":"否"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"是否已认证:"})," ",a.isAuthenticated?"是":"否"]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"注册表单"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"用户名"}),e.jsx("input",{type:"text",value:r,onChange:s=>p(s.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入用户名",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"密码"}),e.jsx("input",{type:"password",value:n,onChange:s=>j(s.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入密码",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"确认密码"}),e.jsx("input",{type:"password",value:x,onChange:s=>y(s.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请再次输入密码",disabled:l})]}),e.jsx("button",{onClick:N,disabled:l,className:`w-full py-3 px-4 rounded-lg transition-colors ${l?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:l?"注册中...":"立即注册"})]})]}),m&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"结果"}),e.jsx("p",{className:"text-lg",children:m})]})]})})})};export{E as default};

import{K as c,Q as n}from"./index-Du8BMbyU.js";const u={useDatabase:!0,fallbackToLocalStorage:!0,apiBaseUrl:"/api"};class g{constructor(t={}){this.config={...u,...t}}async getAllArticles(){try{if(this.config.useDatabase){const t=await c.articles.getAllArticles();if(t.success&&t.data)return t.data.data||t.data}return this.config.fallbackToLocalStorage?await n.getAllArticles():[]}catch(t){return console.error("获取文章列表失败:",t),[]}}async getArticleById(t){try{if(this.config.useDatabase){const e=await c.articles.getArticleById(t);if(e.success&&e.data)return e.data}return this.config.fallbackToLocalStorage&&(await this.getAllArticles()).find(r=>r.id===t)||null}catch(e){return console.error("根据ID获取文章失败:",e),null}}async createArticle(t){try{const e={...t,id:this.generateArticleId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(this.config.useDatabase){const r=await c.articles.createArticle(e);if(r.success&&r.data)return r.data;throw new Error(r.error||"创建文章失败")}if(this.config.fallbackToLocalStorage){const r=await this.getAllArticles();r.push(e),localStorage.setItem("gamehub_articles",JSON.stringify(r))}return e}catch(e){throw console.error("创建文章失败:",e),e}}async updateArticle(t,e){try{const r={...e};if(this.config.useDatabase){console.log("调用API更新文章:",t,r);const a=await c.articles.updateArticle(t,r);if(console.log("API更新结果:",a),a.success&&a.data)return a.data;throw console.error("API更新失败:",a.error),new Error(a.error||"更新文章失败")}if(this.config.fallbackToLocalStorage){const a=await this.getAllArticles(),l=a.findIndex(o=>o.id===t);return l===-1?null:(a[l]={...a[l],...r},localStorage.setItem("gamehub_articles",JSON.stringify(a)),a[l])}return null}catch(r){throw console.error("更新文章失败:",r),r}}async deleteArticle(t){try{if(this.config.useDatabase)return(await c.articles.deleteArticle(t)).success;if(this.config.fallbackToLocalStorage){const e=await this.getAllArticles(),r=e.findIndex(a=>a.id===t);return r===-1?!1:(e.splice(r,1),localStorage.setItem("gamehub_articles",JSON.stringify(e)),!0)}return!1}catch(e){return console.error("删除文章失败:",e),!1}}async getArticlesByCategory(t){try{if(this.config.useDatabase){const e=await c.articles.getArticlesByCategory(t);if(e.success&&e.data)return e.data.data||e.data}return this.config.fallbackToLocalStorage?(await this.getAllArticles()).filter(r=>r.category===t):[]}catch(e){return console.error("根据分类获取文章失败:",e),[]}}async getArticlesByTopic(t){try{return this.config.useDatabase?(await this.getAllArticles()).filter(r=>r.category===t):this.config.fallbackToLocalStorage?(await this.getAllArticles()).filter(r=>r.category===t):[]}catch(e){return console.error("根据主题获取文章失败:",e),[]}}async searchArticles(t){try{if(this.config.useDatabase){const e=await c.articles.searchArticles(t);if(e.success&&e.data)return e.data.data||e.data}return this.config.fallbackToLocalStorage?(await this.getAllArticles()).filter(r=>r.title.toLowerCase().includes(t.toLowerCase())||r.content.toLowerCase().includes(t.toLowerCase())||r.author.toLowerCase().includes(t.toLowerCase())):[]}catch(e){return console.error("搜索文章失败:",e),[]}}async getAllCategories(){try{if(this.config.useDatabase){const t=await c.articles.getAllCategories();if(t.success&&t.data)return t.data}if(this.config.fallbackToLocalStorage){const t=await this.getAllArticles();return[...new Set(t.map(r=>r.category))].filter(r=>r&&r.trim()!=="")}return[]}catch(t){return console.error("获取分类列表失败:",t),[]}}async getAllArticlesSortedByTime(){try{return(await this.getAllArticles()).sort((e,r)=>new Date(r.createdAt).getTime()-new Date(e.createdAt).getTime())}catch(t){return console.error("按时间排序获取文章失败:",t),[]}}async initializeSampleArticles(){try{if((await this.getAllArticles()).length===0){const e=[{title:"欢迎来到游戏中心",content:"欢迎来到我们的游戏中心！这里有很多有趣的游戏等待您来体验。",author:"系统管理员",authorId:"admin_1",authorType:"admin",category:"公告",tags:["欢迎","公告"],likes:0,views:0,comments:0,status:"published"},{title:"游戏攻略分享",content:"这里是一些热门游戏的攻略和技巧分享。",author:"系统管理员",authorId:"admin_1",authorType:"admin",category:"攻略",tags:["攻略","技巧"],likes:0,views:0,comments:0,status:"published"}];for(const r of e)await this.createArticle(r);console.log("示例文章初始化完成")}}catch(t){console.error("初始化示例文章失败:",t)}}generateArticleId(){const t=Date.now(),e=Math.random().toString(36).substr(2,9);return`article_${t}_${e}`}async testConnection(){try{return(await c.testConnection()).success}catch(t){return console.error("数据库连接测试失败:",t),!1}}switchDataSource(t){this.config.useDatabase=t,console.log(`数据源已切换到: ${t?"数据库":"localStorage"}`)}}const i=new g,f=s=>i.getArticleById(s),d=s=>i.createArticle(s),h=(s,t)=>i.updateArticle(s,t),w=s=>i.deleteArticle(s),y=s=>i.getArticlesByTopic(s),m=()=>i.getAllCategories(),S=()=>i.getAllArticlesSortedByTime(),b=()=>i.initializeSampleArticles();export{m as a,y as b,d as c,w as d,f as e,S as g,b as i,h as u};

import{j as s,b as P,u as R,r as c,U as B,E as F,f as q}from"./index-Du8BMbyU.js";import{i as Q,a as U,b as H,g as G,d as I}from"./databaseArticleManager-BChPH7IT.js";import{P as J}from"./ProtectedRoute-Cy_wGfBG.js";import{M as K}from"./MarkdownRenderer-uREq-bPp.js";import{P as O}from"./plus-BASjHXxA.js";import{C as b}from"./calendar-DRkchnUS.js";import{S as V}from"./square-pen-CvzYVxFT.js";import{T as W}from"./trash-2-CNoFtxfl.js";const X=()=>{const i=P(),{currentTheme:o}=R(),[m,j]=c.useState([]),[g,C]=c.useState([]),[v,k]=c.useState([]),[l,p]=c.useState("全部"),[a,h]=c.useState("topic"),[n,w]=c.useState(""),[d,N]=c.useState("最新"),[u,x]=c.useState(null);c.useEffect(()=>{(async()=>{await Q(),setTimeout(async()=>{await T(),await f()},100)})()},[l,a]),c.useEffect(()=>{let e=m;switch(a==="topic"&&l!=="全部"&&(e=e.filter(r=>r.category===l)),n.trim()&&(e=e.filter(r=>r.title.toLowerCase().includes(n.toLowerCase())||r.content.toLowerCase().includes(n.toLowerCase())||r.tags.some(t=>t.toLowerCase().includes(n.toLowerCase())))),d){case"最新":e.sort((r,t)=>new Date(t.createdAt).getTime()-new Date(r.createdAt).getTime());break;case"热门":e.sort((r,t)=>t.likes-r.likes);break;case"最多浏览":e.sort((r,t)=>t.views-r.views);break;case"最多评论":e.sort((r,t)=>t.comments-r.comments);break}C(e)},[m,l,a,n,d]);const T=async()=>{const e=await U();k(["全部",...e])},f=async()=>{let e;a==="topic"&&l!=="全部"?e=await H(l):(e=await G(),e=e.filter(r=>r.status==="published")),j(e)},S=e=>{p(e),h("topic")},M=()=>{h("all"),p("")},A=e=>{i(`/article-edit/${e}`)},E=(e,r)=>{r.stopPropagation(),i(`/article-edit/${e}`)},L=(e,r)=>{r.stopPropagation(),x(e)},z=async()=>{u&&(await I(u)?(await f(),y("文章删除成功！","success")):y("删除失败，请重试！","error"),x(null))},D=()=>{x(null)},y=(e,r)=>{const t=document.createElement("div");t.innerHTML=`
      <div style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${r==="success"?"#10B981":"#EF4444"};
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 9999;
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 14px;
        font-weight: 500;
      ">
        ${r==="success"?"✅":"❌"} ${e}
      </div>
    `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)},$=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return s.jsxs("div",{className:"min-h-screen text-white",style:{backgroundColor:o.colors.background},children:[s.jsx("div",{className:"pt-20"}),s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4",children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",style:{color:o.colors.text},children:"文章管理"}),s.jsxs("button",{onClick:()=>i("/article-editor"),className:"flex items-center justify-center gap-2 px-4 py-2 text-white rounded-lg transition-colors w-full sm:w-auto",style:{backgroundColor:o.colors.primary},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=o.colors.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=o.colors.primary},children:[s.jsx(O,{size:20}),"创建新文章"]})]}),s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"rounded-lg p-6",style:{backgroundColor:o.colors.surface},children:s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsx("input",{type:"text",placeholder:"搜索文章标题、内容或标签...",value:n,onChange:e=>w(e.target.value),className:"w-full px-4 py-2 rounded-lg focus:outline-none",style:{backgroundColor:o.colors.background,borderColor:o.colors.border,border:"1px solid",color:o.colors.text}})}),s.jsx("div",{className:"lg:w-48",children:s.jsxs("select",{value:d,onChange:e=>N(e.target.value),className:"w-full px-4 py-2 rounded-lg focus:outline-none",style:{backgroundColor:o.colors.background,borderColor:o.colors.border,border:"1px solid",color:o.colors.text},children:[s.jsx("option",{value:"最新",children:"最新"}),s.jsx("option",{value:"热门",children:"热门"}),s.jsx("option",{value:"最多浏览",children:"最多浏览"}),s.jsx("option",{value:"最多评论",children:"最多评论"})]})})]})})}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[s.jsx("div",{className:"w-full lg:w-80 flex-shrink-0",children:s.jsxs("div",{className:"rounded-lg p-6",style:{backgroundColor:o.colors.surface},children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:o.colors.text},children:"文章主题"}),s.jsx("div",{className:"space-y-2",children:v.map(e=>s.jsx("button",{onClick:()=>S(e),className:"w-full text-left px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:l===e?o.colors.primary:o.colors.surface,color:o.colors.text},onMouseEnter:r=>{l!==e&&(r.currentTarget.style.backgroundColor=o.colors.hover)},onMouseLeave:r=>{l!==e&&(r.currentTarget.style.backgroundColor=o.colors.surface)},children:e},e))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:o.colors.text},children:"所有文章"}),s.jsx("button",{onClick:M,className:"w-full text-left px-4 py-2 rounded-lg transition-colors",style:{backgroundColor:a==="all"?o.colors.primary:o.colors.surface,color:o.colors.text},onMouseEnter:e=>{a!=="all"&&(e.currentTarget.style.backgroundColor=o.colors.hover)},onMouseLeave:e=>{a!=="all"&&(e.currentTarget.style.backgroundColor=o.colors.surface)},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(b,{size:16}),"按时间排列"]})})]})]})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsxs("div",{className:"rounded-lg p-4 sm:p-6",style:{backgroundColor:o.colors.surface},children:[s.jsx("h2",{className:"text-xl font-semibold mb-6",style:{color:o.colors.text},children:l==="全部"?"全部文章":`分类：${l}`}),g.length===0?s.jsx("div",{className:"text-center py-12",style:{color:o.colors.textSecondary},children:s.jsx("p",{children:n.trim()?"没有找到匹配的文章":"暂无文章"})}):s.jsx("div",{className:"space-y-4",children:g.map(e=>s.jsxs("div",{onClick:()=>A(e.id),className:"rounded-lg p-4 cursor-pointer transition-colors group",style:{backgroundColor:o.colors.surface,borderRadius:o.borderRadius.lg},onMouseEnter:r=>{r.currentTarget.style.backgroundColor=o.colors.hover},onMouseLeave:r=>{r.currentTarget.style.backgroundColor=o.colors.surface},children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start mb-3 gap-2",children:[s.jsx("h3",{className:"text-base sm:text-lg font-semibold transition-colors flex-1",style:{color:o.colors.text},children:e.title}),s.jsxs("div",{className:"flex gap-2 self-end sm:self-auto",children:[s.jsx("button",{onClick:r=>E(e.id,r),className:"p-2 rounded-lg transition-colors",style:{color:o.colors.primary},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(59, 130, 246, 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},title:"编辑文章",children:s.jsx(V,{size:16})}),s.jsx("button",{onClick:r=>L(e.id,r),className:"p-2 rounded-lg transition-colors",style:{color:o.colors.error},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},title:"删除文章",children:s.jsx(W,{size:16})})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm mb-3",style:{color:o.colors.textSecondary},children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(B,{size:12}),e.author]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(b,{size:12}),$(e.createdAt)]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(F,{size:12}),e.views," 浏览"]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[s.jsx("span",{className:"px-2 py-1 text-xs rounded",style:{backgroundColor:`${o.colors.primary}20`,color:o.colors.primary},children:e.category}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(q,{size:12}),s.jsx("span",{className:"text-xs",style:{color:o.colors.textSecondary},children:e.tags.join(", ")})]}),s.jsx("span",{className:"px-2 py-1 text-xs rounded",style:{backgroundColor:e.status==="published"?`${o.colors.success}20`:`${o.colors.warning}20`,color:e.status==="published"?o.colors.success:o.colors.warning},children:e.status==="published"?"已发布":"草稿"})]}),s.jsx("div",{className:"text-sm line-clamp-2",style:{color:o.colors.textSecondary},children:s.jsx(K,{content:e.content.substring(0,150)+"..."})})]},e.id))})]})})]})]}),u&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"rounded-lg p-6 max-w-md w-full mx-4",style:{backgroundColor:o.colors.surface},children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:o.colors.text},children:"确认删除"}),s.jsx("p",{className:"mb-6",style:{color:o.colors.textSecondary},children:"确定要删除这篇文章吗？此操作无法撤销。"}),s.jsxs("div",{className:"flex gap-3 justify-end",children:[s.jsx("button",{onClick:D,className:"px-4 py-2 text-white rounded-lg transition-colors",style:{backgroundColor:o.colors.surface},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=o.colors.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=o.colors.surface},children:"取消"}),s.jsx("button",{onClick:z,className:"px-4 py-2 text-white rounded-lg transition-colors",style:{backgroundColor:o.colors.error},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=o.colors.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=o.colors.error},children:"删除"})]})]})})]})},le=()=>s.jsx(J,{requiredRole:"admin",children:s.jsx(X,{})});export{le as default};

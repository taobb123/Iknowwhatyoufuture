import{j as e,v as W,f as X,l as Y,r as t,i as Z,g as _,p as ee,w as se,E as te,m as b,n as re,x as ae,o as le,t as ie}from"./index-DjexH7CO.js";import{P as ne}from"./ProtectedRoute-JgbDXx5-.js";import{S as oe,R as ce}from"./RichTextEditor-CetPM5Nw.js";import{M as de}from"./MarkdownRenderer-qs_zk1gA.js";import{A as me}from"./arrow-left-U28xwuki.js";import{T as ue}from"./trash-2-CwppPFeO.js";import"./code-VL-XnILv.js";import"./list-BKvYJirC.js";const xe=()=>{const{id:r}=W(),x=X(),{state:n,getUserDisplayName:G}=Y(),[u,A]=t.useState(null),[o,S]=t.useState(""),[c,k]=t.useState(""),[f,T]=t.useState("前端开发"),[g,j]=t.useState([]),[y,E]=t.useState(""),[v,z]=t.useState("draft"),[p,B]=t.useState(!1),[F,D]=t.useState(!0),[M,N]=t.useState(!1),[q,H]=t.useState([]),[w,U]=t.useState(!1),[C,P]=t.useState(!1);t.useEffect(()=>{Z(),r?setTimeout(()=>{K(),R()},100):(R(),D(!1))},[r]);const K=()=>{if(!r)return;const s=_(r);s&&(A(s),S(s.title),k(s.content),T(s.category),j(s.tags),z(s.status)),D(!1)},R=()=>{const s=ee();H(s)},O=async()=>{var s,l,i;if(!o.trim()||!c.trim()){d("请填写标题和内容！","error");return}if(!r&&!b()&&((s=n.user)==null?void 0:s.isGuest)&&!re()){d("当前系统设置禁止游客匿名发表文章，请先注册账户！","error");return}U(!0);try{let a=null;if(r&&u)a=ae(r,{title:o.trim(),content:c.trim(),category:f,tags:g,status:v});else{const m=G(),h=b();a=le({title:o.trim(),content:c.trim(),author:m,authorId:h?h.id:(l=n.user)==null?void 0:l.id,authorType:h?"regular":((i=n.user)==null?void 0:i.userType)||"guest",category:f,tags:g,status:v})}a?(A(a),d("文章保存成功！","success"),setTimeout(()=>{var L,$;const m=b(),h=((L=n.user)==null?void 0:L.role)==="admin"||(($=n.user)==null?void 0:$.role)==="superAdmin";x(m||!h?"/game-hub":"/article-management")},2e3)):d("保存失败，请重试！","error")}catch{d("保存失败，请重试！","error")}finally{U(!1)}},J=async()=>{if(r){P(!0);try{ie(r)?(d("文章删除成功！","success"),setTimeout(()=>{var a,m;const l=b(),i=((a=n.user)==null?void 0:a.role)==="admin"||((m=n.user)==null?void 0:m.role)==="superAdmin";x(l||!i?"/game-hub":"/article-management")},2e3)):d("删除失败，请重试！","error")}catch{d("删除失败，请重试！","error")}finally{P(!1),N(!1)}}},I=()=>{y.trim()&&!g.includes(y.trim())&&(j([...g,y.trim()]),E(""))},Q=s=>{j(g.filter(l=>l!==s))},V=()=>{var i,a;if((o.trim()||c.trim())&&(r&&u?o!==u.title||c!==u.content||f!==u.category:o.trim()!==""||c.trim()!=="")&&!window.confirm("您有未保存的更改，确定要离开吗？"))return;const s=b(),l=((i=n.user)==null?void 0:i.role)==="admin"||((a=n.user)==null?void 0:a.role)==="superAdmin";x(s||!l?"/game-hub":"/article-management")},d=(s,l)=>{const i=document.createElement("div");i.innerHTML=`
      <div style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${l==="success"?"#10B981":"#EF4444"};
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 9999;
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 14px;
        font-weight: 500;
      ">
        ${l==="success"?"✅":"❌"} ${s}
      </div>
    `,document.body.appendChild(i),setTimeout(()=>{i.remove()},3e3)};return F?e.jsx("div",{className:"min-h-screen bg-gray-900 text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{children:"加载中..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[e.jsx("div",{className:"pt-16"}),e.jsx("div",{className:"bg-gray-800 border-b border-gray-700 px-4 sm:px-6 py-4 sticky top-16 z-40",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:V,className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all duration-200 hover:scale-105",children:[e.jsx(me,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"返回"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"text-lg sm:text-xl font-semibold",children:r&&u?"编辑文章":"创建文章"})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>B(!p),className:`flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105 ${p?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-700 text-white hover:bg-gray-600"}`,children:[p?e.jsx(se,{size:16}):e.jsx(te,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:p?"编辑":"预览"})]}),e.jsx("button",{onClick:O,disabled:w,className:`flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-2 rounded-lg transition-all duration-200 hover:scale-105 shadow-lg ${w?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 hover:shadow-green-500/25"}`,children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{className:"hidden sm:inline",children:"保存中..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"保存"})]})}),r&&u&&e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all duration-200 hover:scale-105 shadow-lg hover:shadow-red-500/25",children:[e.jsx(ue,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"删除"})]})]})]})}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("div",{className:"bg-gray-800 rounded-lg p-6 mb-6 shadow-lg border border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"文章标题"}),e.jsx("input",{type:"text",value:o,onChange:s=>S(s.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入文章标题"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"分类"}),e.jsxs("select",{value:f,onChange:s=>T(s.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"选择分类"}),q.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"状态"}),e.jsxs("select",{value:v,onChange:s=>z(s.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"draft",children:"草稿"}),e.jsx("option",{value:"published",children:"已发布"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"标签"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:g.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-600/20 text-blue-400 text-sm rounded-full",children:[s,e.jsx("button",{onClick:()=>Q(s),className:"ml-1 text-blue-300 hover:text-blue-200",children:"×"})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:y,onChange:s=>E(s.target.value),onKeyPress:s=>s.key==="Enter"&&I(),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"添加标签，按回车确认"}),e.jsx("button",{onClick:I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"添加"})]})]})]})}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-4",children:"文章内容"}),p?e.jsx("div",{className:"min-h-[400px] p-4 bg-gray-700 rounded-lg",children:e.jsxs("div",{className:"prose prose-invert max-w-none",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:o||"无标题"}),e.jsx(de,{content:c||"暂无内容"})]})}):e.jsx(ce,{value:c,onChange:k,placeholder:"开始撰写您的文章内容...",className:"rounded-lg"})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-white",children:"确认删除"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"确定要删除这篇文章吗？此操作无法撤销。"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors",children:"取消"}),e.jsx("button",{onClick:J,disabled:C,className:`px-4 py-2 rounded-lg transition-colors ${C?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-500"}`,children:C?"删除中...":"删除"})]})]})})]})},Ne=()=>e.jsx(ne,{requiredRole:"admin",children:e.jsx(xe,{})});export{Ne as default};

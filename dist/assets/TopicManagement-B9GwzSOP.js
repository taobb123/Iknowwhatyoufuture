import{J as x,h as W,u as Y,r as l,j as e}from"./index-CNCBtjWD.js";import{g as Z}from"./databaseBoardManager-A_2RlDqO.js";import{S as ee,a as te,b as re,c as se,d as oe,e as j,f as v,g as w,h as S,i as ae,j as ie,k as ne,l as ce,m as le,n as de,o as he,p as ue,q as xe,r as L,s as I,A as N,t as k,u as d,x as b,v as _,w as z,B as D,z as B}from"./StyledManagementPage-mCttjSDb.js";import{A as pe}from"./arrow-left-C5wMY0UL.js";import{P as me}from"./plus-BrRwgUZk.js";import{C as ge}from"./calendar-BkTuK7cy.js";const je={useDatabase:!0,fallbackToLocalStorage:!1,apiBaseUrl:"/api"};class ye{constructor(s={}){this.config={...je,...s}}async getAllTopics(){try{if(this.config.useDatabase){const s=await x.topics.getAllTopics();if(s.success&&s.data)return(s.data.data||s.data).map(r=>({id:r.id,name:r.name,description:r.description||"",boardId:r.board_id||"",icon:r.icon||"ğŸŒŸ",color:r.color||"from-yellow-500 to-orange-500",order:r.sort_order||0,isActive:r.is_active===1||r.is_active===!0,articleCount:r.article_count||0,createdAt:r.created_at,updatedAt:r.updated_at}))}return this.config.fallbackToLocalStorage?(console.warn("âš ï¸ æ•°æ®åº“ä¸å¯ç”¨ï¼ŒTopicç®¡ç†ä¸æ”¯æŒlocalStorage fallback"),[]):[]}catch(s){return console.error("è·å–ä¸»é¢˜åˆ—è¡¨å¤±è´¥:",s),[]}}async getTopicById(s){try{if(this.config.useDatabase){const o=await x.topics.getTopicById(s);if(o.success&&o.data){const r=o.data;return{id:r.id,name:r.name,description:r.description||"",boardId:r.board_id||"",icon:r.icon||"ğŸŒŸ",color:r.color||"from-yellow-500 to-orange-500",order:r.sort_order||0,isActive:r.is_active===1||r.is_active===!0,articleCount:r.article_count||0,createdAt:r.created_at,updatedAt:r.updated_at}}}return null}catch(o){return console.error("æ ¹æ®IDè·å–ä¸»é¢˜å¤±è´¥:",o),null}}async getTopicsByBoardId(s){try{if(this.config.useDatabase){const o=await x.topics.getTopicsByBoardId(s);if(o.success&&o.data)return(o.data.data||o.data).map(a=>({id:a.id,name:a.name,description:a.description||"",boardId:a.board_id||"",icon:a.icon||"ğŸŒŸ",color:a.color||"from-yellow-500 to-orange-500",order:a.sort_order||0,isActive:a.is_active===1||a.is_active===!0,articleCount:a.article_count||0,createdAt:a.created_at,updatedAt:a.updated_at}))}return[]}catch(o){return console.error("æ ¹æ®æ¿å—IDè·å–ä¸»é¢˜å¤±è´¥:",o),[]}}async addTopic(s){try{if(this.config.useDatabase){const o=await x.topics.createTopic({name:s.name,description:s.description,board_id:s.boardId,icon:s.icon,color:s.color,sort_order:s.order,is_active:s.isActive});if(o.success&&o.data){const r=o.data;return{id:r.id,name:r.name,description:r.description||"",boardId:r.board_id||"",icon:r.icon||"ğŸŒŸ",color:r.color||"from-yellow-500 to-orange-500",order:r.sort_order||0,isActive:r.is_active===1||r.is_active===!0,articleCount:r.article_count||0,createdAt:r.created_at,updatedAt:r.updated_at}}else throw new Error(o.error||"åˆ›å»ºä¸»é¢˜å¤±è´¥")}throw new Error("æ•°æ®åº“ä¸å¯ç”¨")}catch(o){throw console.error("æ·»åŠ ä¸»é¢˜å¤±è´¥:",o),o}}async updateTopic(s,o){try{if(this.config.useDatabase){const r=await x.topics.updateTopic(s,{name:o.name,description:o.description,board_id:o.boardId,icon:o.icon,color:o.color,sort_order:o.order,is_active:o.isActive});if(r.success&&r.data){const a=r.data;return{id:a.id,name:a.name,description:a.description||"",boardId:a.board_id||"",icon:a.icon||"ğŸŒŸ",color:a.color||"from-yellow-500 to-orange-500",order:a.sort_order||0,isActive:a.is_active===1||a.is_active===!0,articleCount:a.article_count||0,createdAt:a.created_at,updatedAt:a.updated_at}}else throw new Error(r.error||"æ›´æ–°ä¸»é¢˜å¤±è´¥")}throw new Error("æ•°æ®åº“ä¸å¯ç”¨")}catch(r){throw console.error("æ›´æ–°ä¸»é¢˜å¤±è´¥:",r),r}}async deleteTopic(s){try{if(this.config.useDatabase)return(await x.topics.deleteTopic(s)).success;throw new Error("æ•°æ®åº“ä¸å¯ç”¨")}catch(o){throw console.error("åˆ é™¤ä¸»é¢˜å¤±è´¥:",o),o}}async getTopicStats(){try{if(this.config.useDatabase){const s=await x.topics.getTopicStats();if(s.success&&s.data)return s.data}return{total_topics:0,active_topics:0,total_articles:0,avg_articles_per_topic:0}}catch(s){return console.error("è·å–ä¸»é¢˜ç»Ÿè®¡å¤±è´¥:",s),{total_topics:0,active_topics:0,total_articles:0,avg_articles_per_topic:0}}}async testConnection(){try{return await x.testConnection()}catch(s){return console.error("æµ‹è¯•æ•°æ®åº“è¿æ¥å¤±è´¥:",s),!1}}switchDataSource(s){console.warn("åœ¨MySQL-onlyæ¶æ„ä¸­ï¼ŒswitchDataSourceæ–¹æ³•ä¸å†æœ‰å®é™…ä½œç”¨")}}const T=new ye,fe=()=>T.getAllTopics(),ve=u=>T.addTopic(u),we=(u,s)=>T.updateTopic(u,s),Se=u=>T.deleteTopic(u),Ne=()=>{const u=W(),{currentTheme:s}=Y(),[o,r]=l.useState([]),[a,P]=l.useState([]),[X,E]=l.useState(!0),[H,y]=l.useState(!1),[$,C]=l.useState(!1),[M,A]=l.useState(null),[p,F]=l.useState(null),[m,g]=l.useState(""),[i,c]=l.useState({name:"",description:"",icon:"ğŸŒŸ",color:"from-yellow-500 to-orange-500"});l.useEffect(()=>{U()},[]);const U=async()=>{try{console.log("åŠ è½½ä¸»é¢˜å’Œæ¿å—æ•°æ®...");const t=await Z();P(t);const n=await fe();r(n),console.log("åŠ è½½çš„æ•°æ®:",{boards:t.length,topics:n.length}),E(!1)}catch(t){console.error("åŠ è½½æ•°æ®å¤±è´¥:",t),E(!1)}},q=async()=>{if(!m){const t=document.createElement("div");t.innerHTML=`
        <div style="
          position: fixed;
          top: 150px;
          right: 200px;
          background: #F59E0B;
          color: white;
          padding: 16px 24px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          z-index: 10000;
          font-family: system-ui, -apple-system, sans-serif;
          font-size: 14px;
          font-weight: 500;
          animation: slideIn 0.3s ease-out;
        ">
          âš ï¸ è¯·é€‰æ‹©æ‰€å±æ¿å—
        </div>
        <style>
          @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
        </style>
      `,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3);return}try{console.log("åˆ›å»ºä¸»é¢˜:",{...i,boardId:m});const t=await ve({...i,boardId:m,order:0,isActive:!0});r([...o,t]),y(!1),c({name:"",description:"",icon:"ğŸŒŸ",color:"from-yellow-500 to-orange-500"}),g(""),console.log("ä¸»é¢˜åˆ›å»ºæˆåŠŸ")}catch(t){console.error("åˆ›å»ºä¸»é¢˜å¤±è´¥:",t)}},G=async()=>{if(p)try{console.log("æ›´æ–°ä¸»é¢˜:",p.id,i);const t=await we(p.id,{...i,boardId:m,order:p.order,isActive:p.isActive});r(o.map(n=>n.id===p.id?t:n)),C(!1),F(null),c({name:"",description:"",icon:"ğŸŒŸ",color:"from-yellow-500 to-orange-500"}),g(""),f("ä¸»é¢˜æ›´æ–°æˆåŠŸï¼","success"),console.log("ä¸»é¢˜æ›´æ–°æˆåŠŸ")}catch(t){console.error("æ›´æ–°ä¸»é¢˜å¤±è´¥:",t),f("ä¸»é¢˜æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•","error")}},J=async t=>{try{console.log("åˆ é™¤ä¸»é¢˜:",t),await Se(t)&&(r(o.filter(h=>h.id!==t)),A(null),f("ä¸»é¢˜åˆ é™¤æˆåŠŸï¼","success"),console.log("ä¸»é¢˜åˆ é™¤æˆåŠŸ"))}catch(n){console.error("åˆ é™¤ä¸»é¢˜å¤±è´¥:",n),f("ä¸»é¢˜åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•","error")}},O=t=>{F(t),c({name:t.name,description:t.description,icon:t.icon,color:t.color}),g(t.boardId),C(!0)},Q=t=>{const n=a.find(h=>h.id===t);return n?n.name:"æœªçŸ¥æ¿å—"},R=t=>new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),f=(t,n)=>{const h=document.createElement("div"),K=n==="success"?s.colors.success:s.colors.error,V=n==="success"?"âœ…":"âŒ";h.innerHTML=`
      <div style="
        position: fixed;
        top: 150px;
        right: 200px;
        background: ${K};
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10000;
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 14px;
        font-weight: 500;
        animation: slideIn 0.3s ease-out;
        max-width: 300px;
      ">
        ${V} ${t}
      </div>
      <style>
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      </style>
    `,document.body.appendChild(h),setTimeout(()=>{h.parentNode&&h.parentNode.removeChild(h)},3e3)};return X?e.jsx("div",{className:"min-h-screen text-white flex items-center justify-center",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:s.colors.textSecondary}}),e.jsx("p",{style:{color:s.colors.text},children:"åŠ è½½ä¸­..."})]})}):e.jsx(ee,{children:e.jsxs(te,{children:[e.jsxs(re,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(se,{onClick:()=>u(-1),children:[e.jsx(pe,{size:16}),"è¿”å›"]}),e.jsx(oe,{children:"ä¸»é¢˜ç®¡ç†"})]}),e.jsxs(j,{onClick:()=>y(!0),children:[e.jsx(me,{size:16}),"åˆ›å»ºä¸»é¢˜"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(v,{children:[e.jsx(w,{children:o.length}),e.jsx(S,{children:"æ€»ä¸»é¢˜æ•°"})]}),e.jsxs(v,{children:[e.jsx(w,{children:o.filter(t=>t.isActive).length}),e.jsx(S,{children:"æ´»è·ƒä¸»é¢˜"})]}),e.jsxs(v,{children:[e.jsx(w,{children:a.length}),e.jsx(S,{children:"æ€»æ¿å—æ•°"})]}),e.jsxs(v,{children:[e.jsx(w,{children:"0"}),e.jsx(S,{children:"æ€»æ–‡ç« æ•°"})]})]}),e.jsxs(ae,{children:[e.jsx(ie,{children:"ä¸»é¢˜åˆ—è¡¨"}),o.length===0?e.jsxs(ne,{children:[e.jsx(ce,{children:"æš‚æ— ä¸»é¢˜æ•°æ®"}),e.jsx(j,{onClick:()=>y(!0),children:"åˆ›å»ºç¬¬ä¸€ä¸ªä¸»é¢˜"})]}):e.jsx("div",{className:"space-y-4",children:o.map(t=>e.jsxs(le,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{children:[e.jsx(de,{children:t.name}),e.jsx(he,{children:t.description}),e.jsxs(ue,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{size:12}),R(t.createdAt)]}),e.jsxs("span",{children:["æ‰€å±æ¿å—: ",Q(t.boardId)]}),e.jsx(xe,{isActive:t.isActive,children:t.isActive?"æ´»è·ƒ":"å·²å…³é—­"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm",style:{color:s.colors.textSecondary},children:[t.articleCount," ç¯‡æ–‡ç« "]}),e.jsx(j,{onClick:()=>O(t),className:"px-3 py-1 text-sm",children:"ç¼–è¾‘"}),e.jsx(L,{onClick:()=>A(t.id),className:"px-3 py-1 text-sm",children:"åˆ é™¤"})]})]},t.id))})]}),H&&e.jsxs(I,{hasFixedFooter:!0,children:[e.jsxs(N,{children:[e.jsx(k,{children:"åˆ›å»ºä¸»é¢˜"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"æ‰€å±æ¿å—"}),e.jsxs(b,{value:m,onChange:t=>g(t.target.value),children:[e.jsx("option",{value:"",children:"é€‰æ‹©æ¿å—"}),a.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"ä¸»é¢˜åç§°"}),e.jsx(_,{type:"text",value:i.name,onChange:t=>c({...i,name:t.target.value}),placeholder:"è¾“å…¥ä¸»é¢˜åç§°"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"ä¸»é¢˜æè¿°"}),e.jsx(z,{value:i.description,onChange:t=>c({...i,description:t.target.value}),rows:3,placeholder:"è¾“å…¥ä¸»é¢˜æè¿°"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"å›¾æ ‡"}),e.jsx(_,{type:"text",value:i.icon,onChange:t=>c({...i,icon:t.target.value}),placeholder:"é€‰æ‹©å›¾æ ‡"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"é¢œè‰²"}),e.jsxs(b,{value:i.color,onChange:t=>c({...i,color:t.target.value}),children:[e.jsx("option",{value:"from-yellow-500 to-orange-500",children:"é»„è‰²åˆ°æ©™è‰²"}),e.jsx("option",{value:"from-purple-500 to-pink-500",children:"ç´«è‰²åˆ°ç²‰è‰²"}),e.jsx("option",{value:"from-indigo-500 to-blue-500",children:"é›è“åˆ°è“è‰²"}),e.jsx("option",{value:"from-green-500 to-teal-500",children:"ç»¿è‰²åˆ°é’è‰²"})]})]})]})]}),e.jsxs(D,{children:[e.jsx(B,{onClick:()=>y(!1),children:"å–æ¶ˆ"}),e.jsx(j,{onClick:q,children:"åˆ›å»º"})]})]}),$&&e.jsxs(I,{hasFixedFooter:!0,children:[e.jsxs(N,{children:[e.jsx(k,{children:"ç¼–è¾‘ä¸»é¢˜"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"æ‰€å±æ¿å—"}),e.jsxs(b,{value:m,onChange:t=>g(t.target.value),children:[e.jsx("option",{value:"",children:"é€‰æ‹©æ¿å—"}),a.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"ä¸»é¢˜åç§°"}),e.jsx(_,{type:"text",value:i.name,onChange:t=>c({...i,name:t.target.value}),placeholder:"è¾“å…¥ä¸»é¢˜åç§°"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"ä¸»é¢˜æè¿°"}),e.jsx(z,{value:i.description,onChange:t=>c({...i,description:t.target.value}),rows:3,placeholder:"è¾“å…¥ä¸»é¢˜æè¿°"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"å›¾æ ‡"}),e.jsx(_,{type:"text",value:i.icon,onChange:t=>c({...i,icon:t.target.value}),placeholder:"é€‰æ‹©å›¾æ ‡"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"é¢œè‰²"}),e.jsxs(b,{value:i.color,onChange:t=>c({...i,color:t.target.value}),children:[e.jsx("option",{value:"from-yellow-500 to-orange-500",children:"é»„è‰²åˆ°æ©™è‰²"}),e.jsx("option",{value:"from-purple-500 to-pink-500",children:"ç´«è‰²åˆ°ç²‰è‰²"}),e.jsx("option",{value:"from-indigo-500 to-blue-500",children:"é›è“åˆ°è“è‰²"}),e.jsx("option",{value:"from-green-500 to-teal-500",children:"ç»¿è‰²åˆ°é’è‰²"})]})]})]})]}),e.jsxs(D,{children:[e.jsx(B,{onClick:()=>C(!1),children:"å–æ¶ˆ"}),e.jsx(j,{onClick:G,children:"ä¿å­˜"})]})]}),M&&e.jsxs(I,{children:[e.jsxs(N,{children:[e.jsx(k,{children:"ç¡®è®¤åˆ é™¤"}),e.jsx("p",{className:"mb-6",style:{color:s.colors.textSecondary},children:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¸»é¢˜å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚"})]}),e.jsxs(D,{children:[e.jsx(B,{onClick:()=>A(null),children:"å–æ¶ˆ"}),e.jsx(L,{onClick:()=>J(M),children:"åˆ é™¤"})]})]})]})})};export{Ne as default};

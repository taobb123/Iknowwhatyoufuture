import{c as y,l as Z,u as X,r as a,B as E,D as S,F as Y,I as _,j as e,U as L,J as ee,K as z,M as se,O as te,Q as re,V as le,W as ae}from"./index-DjexH7CO.js";import{C as D}from"./crown-BTUpNONj.js";import{P as oe}from"./plus-CsLKypcW.js";import{C as ce}from"./calendar-DcrdUgBW.js";import{T as ne}from"./trash-2-CwppPFeO.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=y("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=y("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=y("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=y("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),be=()=>{const{state:A,isSuperAdmin:P}=Z(),{currentTheme:s}=X(),[$,q]=a.useState([]),[x,I]=a.useState(E()),[F,b]=a.useState(!1),[G,f]=a.useState(!1),[j,N]=a.useState(null),[v,w]=a.useState(null),[r,k]=a.useState({username:"",email:"",password:"",role:"user",isActive:!0}),[i,c]=a.useState(""),[u,h]=a.useState(!1),[n,T]=a.useState(S()),[C,M]=a.useState(!1);a.useEffect(()=>{g(),Y(),T(S())},[]);const g=()=>{const t=_();q(t),I(E())},o=t=>{const{name:l,value:m,type:Q}=t.target;k(W=>({...W,[l]:Q==="checkbox"?t.target.checked:m})),i&&c("")},R=async t=>{if(t.preventDefault(),!r.username.trim()||!r.email.trim()||!r.password.trim()){c("请填写所有必填字段");return}h(!0),c("");try{await te({username:r.username.trim(),email:r.email.trim(),password:r.password,role:r.role,isActive:r.isActive}),g(),b(!1),d(),p("用户添加成功！","success")}catch(l){c(l.message||"添加用户失败")}finally{h(!1)}},B=async t=>{if(t.preventDefault(),!!v){if(!r.username.trim()||!r.email.trim()){c("请填写所有必填字段");return}h(!0),c("");try{const l={username:r.username.trim(),email:r.email.trim(),role:r.role,isActive:r.isActive};r.password.trim()&&(l.password=r.password),await re(v.id,l),g(),f(!1),w(null),d(),p("用户更新成功！","success")}catch(l){c(l.message||"更新用户失败")}finally{h(!1)}}},H=async()=>{if(j)try{await le(j),g(),N(null),p("用户删除成功！","success")}catch{p("删除用户失败","error")}},V=t=>{w(t),k({username:t.username,email:t.email,password:"",role:t.role,isActive:t.isActive}),f(!0)},d=()=>{k({username:"",email:"",password:"",role:"user",isActive:!0}),c("")},p=(t,l)=>{const m=document.createElement("div");m.innerHTML=`
      <div style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${l==="success"?"#10B981":"#EF4444"};
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 9999;
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 14px;
        font-weight: 500;
      ">
        ${l==="success"?"✅":"❌"} ${t}
      </div>
    `,document.body.appendChild(m),setTimeout(()=>{m.remove()},3e3)},J=t=>{switch(t){case"superAdmin":return e.jsx(D,{className:"h-4 w-4 text-yellow-400"});case"admin":return e.jsx(z,{className:"h-4 w-4 text-blue-400"});default:return e.jsx(L,{className:"h-4 w-4 text-gray-400"})}},K=t=>{switch(t){case"superAdmin":return"超级管理员";case"admin":return"管理员";default:return"普通用户"}},U=t=>new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),O=async()=>{if(A.user){M(!0);try{const t=!n.allowGuestAnonymousPost;ae(t,A.user.username),T(S()),alert(`✅ ${t?"已允许游客匿名发表文章":"已禁止游客匿名发表文章"}`)}catch(t){console.error("更新系统配置失败:",t),alert("❌ 更新配置失败，请重试")}finally{M(!1)}}};return P()?e.jsxs("div",{className:"min-h-screen text-white",style:{backgroundColor:s.colors.background},children:[e.jsx("div",{className:"pt-16"}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",style:{color:s.colors.text},children:"用户管理"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"rounded-lg p-6",style:{backgroundColor:s.colors.surface},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-8 w-8",style:{color:s.colors.primary}}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"总用户数"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:s.colors.text},children:x.total})]})]})}),e.jsx("div",{className:"rounded-lg p-6",style:{backgroundColor:s.colors.surface},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"h-8 w-8",style:{color:s.colors.success}}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"活跃用户"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:s.colors.text},children:x.active})]})]})}),e.jsx("div",{className:"rounded-lg p-6",style:{backgroundColor:s.colors.surface},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-8 w-8",style:{color:s.colors.primary}}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"管理员"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:s.colors.text},children:x.admins})]})]})}),e.jsx("div",{className:"rounded-lg p-6",style:{backgroundColor:s.colors.surface},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-8 w-8",style:{color:s.colors.warning}}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm",style:{color:s.colors.textSecondary},children:"超级管理员"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:s.colors.text},children:x.superAdmins})]})]})})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"rounded-lg p-6",style:{backgroundColor:s.colors.surface},children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(se,{className:"h-6 w-6 mr-3",style:{color:s.colors.warning}}),e.jsx("h2",{className:"text-xl font-bold",style:{color:s.colors.text},children:"系统配置"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-1",children:"游客匿名发表文章"}),e.jsx("p",{className:"text-sm text-gray-400",children:n.allowGuestAnonymousPost?"当前允许游客匿名发表文章":"当前禁止游客匿名发表文章"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["最后更新: ",U(n.lastUpdated)," | 更新者: ",n.updatedBy]})]}),e.jsx("button",{onClick:O,disabled:C,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${n.allowGuestAnonymousPost?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white"} ${C?"opacity-50 cursor-not-allowed":""}`,children:C?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):n.allowGuestAnonymousPost?e.jsxs(e.Fragment,{children:[e.jsx(xe,{size:16}),"允许"]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{size:16}),"禁止"]})})]})})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>{d(),b(!0)},className:"flex items-center gap-2 px-4 py-2 text-white rounded-lg transition-colors",style:{backgroundColor:s.colors.primary},onMouseEnter:t=>{t.currentTarget.style.backgroundColor=s.colors.hover},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=s.colors.primary},children:[e.jsx(oe,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"添加用户"})]})}),e.jsx("div",{className:"rounded-lg overflow-hidden",style:{backgroundColor:s.colors.surface},children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y",style:{borderColor:s.colors.border},children:[e.jsx("thead",{style:{backgroundColor:s.colors.hover},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:s.colors.textSecondary},children:"用户信息"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:s.colors.textSecondary},children:"角色"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:s.colors.textSecondary},children:"状态"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:s.colors.textSecondary},children:"创建时间"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:s.colors.textSecondary},children:"操作"})]})}),e.jsx("tbody",{className:"divide-y",style:{borderColor:s.colors.border},children:$.map(t=>e.jsxs("tr",{className:"transition-colors",onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.colors.hover},onMouseLeave:l=>{l.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",style:{color:s.colors.text},children:t.username}),e.jsxs("div",{className:"text-sm flex items-center gap-1",style:{color:s.colors.textSecondary},children:[e.jsx(ie,{className:"h-3 w-3"}),t.email||"无邮箱"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[J(t.role),e.jsx("span",{className:"text-sm",style:{color:s.colors.textSecondary},children:K(t.role)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full",style:{backgroundColor:t.isActive?`${s.colors.success}20`:`${s.colors.error}20`,color:t.isActive?s.colors.success:s.colors.error},children:t.isActive?"活跃":"禁用"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",style:{color:s.colors.textSecondary},children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),U(t.createdAt)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>V(t),className:"p-1 transition-colors",style:{color:s.colors.primary},onMouseEnter:l=>{l.currentTarget.style.color=s.colors.hover},onMouseLeave:l=>{l.currentTarget.style.color=s.colors.primary},title:"编辑用户",children:e.jsx(de,{size:16})}),e.jsx("button",{onClick:()=>N(t.id),className:"p-1 transition-colors",style:{color:s.colors.error},onMouseEnter:l=>{l.currentTarget.style.color=s.colors.hover},onMouseLeave:l=>{l.currentTarget.style.color=s.colors.error},title:"删除用户",children:e.jsx(ne,{size:16})})]})})]},t.id))})]})})}),F&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-white",children:"添加用户"}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"用户名"}),e.jsx("input",{type:"text",name:"username",value:r.username,onChange:o,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"邮箱"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:o,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"密码"}),e.jsx("input",{type:"password",name:"password",value:r.password,onChange:o,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"角色"}),e.jsxs("select",{name:"role",value:r.role,onChange:o,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"user",children:"普通用户"}),e.jsx("option",{value:"admin",children:"管理员"}),e.jsx("option",{value:"superAdmin",children:"超级管理员"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:r.isActive,onChange:o,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-600 rounded bg-gray-700"}),e.jsx("label",{className:"ml-2 text-sm text-gray-300",children:"激活用户"})]})]}),i&&e.jsx("div",{className:"mt-4 text-red-400 text-sm",children:i}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{b(!1),d()},className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors",children:"取消"}),e.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:u?"添加中...":"添加"})]})]})]})}),G&&v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-white",children:"编辑用户"}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"用户名"}),e.jsx("input",{type:"text",name:"username",value:r.username,onChange:o,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"邮箱"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:o,className:`w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.email?"":"opacity-50 cursor-not-allowed"}`,disabled:!r.email,required:!!r.email}),!r.email&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"简单注册用户无邮箱字段"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"新密码（留空则不修改）"}),e.jsx("input",{type:"password",name:"password",value:r.password,onChange:o,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"留空则不修改密码"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"角色"}),e.jsxs("select",{name:"role",value:r.role,onChange:o,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"user",children:"普通用户"}),e.jsx("option",{value:"admin",children:"管理员"}),e.jsx("option",{value:"superAdmin",children:"超级管理员"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:r.isActive,onChange:o,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-600 rounded bg-gray-700"}),e.jsx("label",{className:"ml-2 text-sm text-gray-300",children:"激活用户"})]})]}),i&&e.jsx("div",{className:"mt-4 text-red-400 text-sm",children:i}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{f(!1),w(null),d()},className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors",children:"取消"}),e.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:u?"更新中...":"更新"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-white",children:"确认删除"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"确定要删除这个用户吗？此操作无法撤销。"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>N(null),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors",children:"取消"}),e.jsx("button",{onClick:H,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-500 transition-colors",children:"删除"})]})]})})]})]}):e.jsx("div",{className:"min-h-screen text-white flex items-center justify-center",style:{backgroundColor:s.colors.background},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl mb-4",style:{color:s.colors.error},children:"权限不足"}),e.jsx("p",{style:{color:s.colors.textSecondary},children:"只有超级管理员可以访问用户管理页面"})]})})};export{be as default};

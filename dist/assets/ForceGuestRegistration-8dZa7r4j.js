import{h as A,r as c,j as s,W as g,A as m,Z as w}from"./index-BCw3XfMH.js";import{m as R}from"./minimalRegistration-BGXYDreK.js";const F=()=>{var f,p,y;const{state:o,registerGuest:T}=A(),[r,v]=c.useState(""),[n,N]=c.useState(""),[h,C]=c.useState(""),[b,t]=c.useState(""),[l,i]=c.useState(!1),x=()=>{const e=g(),d=m(),j={currentUser:e,allUsers:d,authState:o,isGuest:e==null?void 0:e.isGuest,userType:e==null?void 0:e.userType};console.log("当前状态:",j),t(`当前用户: ${(e==null?void 0:e.username)||"无"}, 类型: ${(e==null?void 0:e.userType)||"无"}, 是否游客: ${e!=null&&e.isGuest?"是":"否"}`)},G=()=>{try{console.log("强制创建游客用户...");const e=w();console.log("游客用户已创建:",e),x(),t("✅ 游客用户已强制创建")}catch(e){console.error("创建游客用户失败:",e),t(`❌ 创建游客用户失败: ${e}`)}},k=()=>{try{console.log("清除当前用户..."),localStorage.removeItem("gamehub_current_user"),console.log("当前用户已清除"),x(),t("✅ 当前用户已清除")}catch(e){console.error("清除用户失败:",e),t(`❌ 清除用户失败: ${e}`)}},S=()=>r.trim()?r.length<3?(t("❌ 用户名至少3个字符"),!1):n?n.length<6?(t("❌ 密码至少6个字符"),!1):n!==h?(t("❌ 两次输入的密码不一致"),!1):!0:(t("❌ 请输入密码"),!1):(t("❌ 请输入用户名"),!1),$=async()=>{if(S()){i(!0),t("注册中...");try{const e=g(),d=m();if(console.log("注册前状态:",{currentUser:e,allUsers:d,username:r,isGuest:e==null?void 0:e.isGuest}),!e||!e.isGuest){console.log("当前用户不是游客，强制创建游客用户...");const a=w();console.log("游客用户已创建:",a);const u=g();if(!u||!u.isGuest){t("❌ 无法创建游客用户"),i(!1);return}}if(d.find(a=>a.username===r)){t(`❌ 用户名 "${r}" 已存在`),i(!1);return}if(R(r,n)){t("✅ 注册成功！");const a=g(),u=m();console.log("注册后状态:",{newCurrentUser:a,newAllUsers:u})}else t("❌ 注册失败")}catch(e){console.error("注册错误:",e),t(`❌ 注册错误: ${e instanceof Error?e.message:e}`)}finally{i(!1)}}};return s.jsx("div",{className:"min-h-screen bg-gray-900 text-white pt-20",children:s.jsx("div",{className:"container mx-auto px-6 py-8",children:s.jsxs("div",{className:"max-w-md mx-auto",children:[s.jsx("h1",{className:"text-3xl font-bold mb-8 text-center",children:"强制游客注册"}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"状态检查"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("button",{onClick:x,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"检查当前状态"}),s.jsx("button",{onClick:G,className:"w-full py-3 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"强制创建游客用户"}),s.jsx("button",{onClick:k,className:"w-full py-3 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"清除当前用户"})]}),s.jsxs("div",{className:"mt-4 text-sm text-gray-300",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"当前用户:"})," ",((f=o.user)==null?void 0:f.username)||"无"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"用户类型:"})," ",((p=o.user)==null?void 0:p.userType)||"无"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"是否游客:"})," ",(y=o.user)!=null&&y.isGuest?"是":"否"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"是否已认证:"})," ",o.isAuthenticated?"是":"否"]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"注册表单"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"用户名"}),s.jsx("input",{type:"text",value:r,onChange:e=>v(e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入用户名",disabled:l})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"密码"}),s.jsx("input",{type:"password",value:n,onChange:e=>N(e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入密码",disabled:l})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"确认密码"}),s.jsx("input",{type:"password",value:h,onChange:e=>C(e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请再次输入密码",disabled:l})]}),s.jsx("button",{onClick:$,disabled:l,className:`w-full py-3 px-4 rounded-lg transition-colors ${l?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:l?"注册中...":"立即注册"})]})]}),b&&s.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"结果"}),s.jsx("p",{className:"text-lg",children:b})]})]})})})};export{F as default};
